<div class="container-fluid mt-3 mb-5">
  
  <!-- üéÇ PANEL DE CUMPLEA√ëOS SEMANALES -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body p-3 bg-light">
      <div class="d-flex align-items-center mb-3">
        <i class="bi bi-balloon-heart-fill text-danger fs-4 me-2"></i>
        <h5 class="mb-0 fw-bold text-dark">üéÇ Cumplea√±os Pr√≥ximos (7 d√≠as)</h5>
      </div>
      
      <div *ngIf="cumpleanosHoy.length === 0 && cumpleanosProximos.length === 0" class="text-center py-3">
        <p class="text-muted mb-0">No hay cumplea√±os en los pr√≥ximos 7 d√≠as</p>
      </div>
      
      <!-- Cumplea√±eros de HOY -->
      <div *ngIf="cumpleanosHoy.length > 0" class="mb-3">
        <h6 class="text-success fw-bold mb-2">
          <i class="bi bi-gift-fill me-1"></i> ¬°Feliz Cumplea√±os Hoy!
        </h6>
        <div class="row g-2">
          <div *ngFor="let emp of cumpleanosHoy" class="col-12 col-md-6 col-lg-4">
            <div class="card border-success border-2 shadow-sm cumple-hoy-card">
              <div class="card-body p-2">
                <div class="d-flex align-items-center">
                  <img [src]="getFoto(emp)" 
                       class="rounded-circle me-2" 
                       width="40" 
                       height="40"
                       style="object-fit: cover;"
                       (error)="onImageError($event)">
                  <div class="flex-grow-1">
                    <strong class="d-block">{{ emp.nombre }}</strong>
                    <small class="text-success fw-bold">
                      <i class="bi bi-balloon-fill me-1"></i>
                      üéâ ¬°Feliz cumplea√±os!
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Pr√≥ximos cumplea√±os -->
      <div *ngIf="cumpleanosProximos.length > 0">
        <h6 class="text-primary fw-bold mb-2">
          <i class="bi bi-calendar-heart me-1"></i> Pr√≥ximos Cumplea√±os
        </h6>
        <div class="row g-2">
          <div *ngFor="let emp of cumpleanosProximos" class="col-12 col-md-6 col-lg-4">
            <div class="card border-0 shadow-sm">
              <div class="card-body p-2">
                <div class="d-flex align-items-center">
                  <img [src]="getFoto(emp)" 
                       class="rounded-circle me-2" 
                       width="35" 
                       height="35"
                       style="object-fit: cover;"
                       (error)="onImageError($event)">
                  <div class="flex-grow-1">
                    <strong class="d-block" style="font-size: 0.9rem;">{{ emp.nombre }}</strong>
                    <small class="text-muted" style="font-size: 0.8rem;">
                      <i class="bi bi-calendar3 me-1"></i>
                      Cumple el {{ emp.fechaCumpleFormateada }}
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Info de rango -->
      <div class="mt-3 pt-2 border-top">
        <small class="text-muted">
          <i class="bi bi-info-circle me-1"></i>
          Mostrando cumplea√±os dentro de los pr√≥ximos 7 d√≠as (zona horaria: Per√∫ UTC-5)
        </small>
      </div>
    </div>
  </div>

  <!-- üèõÔ∏è T√çTULO DEL ORGANIGRAMA -->
  <div class="text-center mb-4">
    <h2 class="text-primary fw-bold">
      <i class="bi bi-diagram-3-fill me-2"></i>Organigrama Institucional
    </h2>
    <p class="text-muted">Estructura jer√°rquica del equipo NGR</p>
  </div>

  <!-- ‚è≥ LOADING -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="text-muted mt-2">Cargando estructura organizacional...</p>
  </div>

  <!-- üèóÔ∏è ESTRUCTURA DE PIR√ÅMIDE - SIN ROLES VISIBLES -->
  <div *ngIf="!isLoading" class="org-pyramid-container">
    
    <!-- 1Ô∏è‚É£ NIVEL: JEFATURAS / ADMIN - SIN ROL -->
    <div *ngIf="nivelJefes.length > 0" class="pyramid-level level-1">
      <div class="level-label">
        <span class="badge bg-primary px-3 py-2">
          <i class="bi bi-award-fill me-1"></i> Jefaturas & Administraci√≥n
        </span>
      </div>
      <div class="level-cards">
        <div *ngFor="let emp of nivelJefes" 
             class="pyramid-card card-jefe"
             (click)="seleccionarEmpleado(emp)">
          <div class="card-inner">
            <img [src]="getFoto(emp)" 
                 class="emp-img"
                 (error)="onImageError($event)"
                 alt="{{ emp.nombre }}">
            <div class="emp-info">
              <h6 class="emp-name">{{ emp.nombre }}</h6>
              <small class="emp-cargo">{{ getNivelDisplay(emp) }}</small>
              <!-- SIN BADGE DE ROL -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 2Ô∏è‚É£ NIVEL: SUPERVISORES - SIN ROL -->
    <div *ngIf="nivelSupervisores.length > 0" class="pyramid-level level-2">
      <div class="level-label">
        <span class="badge bg-info px-3 py-2">
          <i class="bi bi-eye-fill me-1"></i> Supervisores
        </span>
      </div>
      <div class="level-cards">
        <div *ngFor="let emp of nivelSupervisores" 
             class="pyramid-card card-supervisor"
             (click)="seleccionarEmpleado(emp)">
          <div class="card-inner">
            <img [src]="getFoto(emp)" 
                 class="emp-img"
                 (error)="onImageError($event)"
                 alt="{{ emp.nombre }}">
            <div class="emp-info">
              <h6 class="emp-name">{{ emp.nombre }}</h6>
              <small class="emp-cargo">{{ getNivelDisplay(emp) }}</small>
              <!-- SIN BADGE DE ROL -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 3Ô∏è‚É£ NIVEL: T√âCNICOS - SIN ROL -->
    <div *ngIf="nivelTecnicos.length > 0" class="pyramid-level level-3">
      <div class="level-label">
        <span class="badge bg-success px-3 py-2">
          <i class="bi bi-tools me-1"></i> T√©cnicos
        </span>
      </div>
      <div class="level-cards">
        <div *ngFor="let emp of nivelTecnicos" 
             class="pyramid-card card-tecnico"
             (click)="seleccionarEmpleado(emp)">
          <div class="card-inner">
            <img [src]="getFoto(emp)" 
                 class="emp-img"
                 (error)="onImageError($event)"
                 alt="{{ emp.nombre }}">
            <div class="emp-info">
              <h6 class="emp-name">{{ emp.nombre }}</h6>
              <small class="emp-cargo">{{ getNivelDisplay(emp) }}</small>
              <!-- SIN BADGE DE ROL -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 4Ô∏è‚É£ NIVEL: HD - SIN ROL -->
    <div *ngIf="nivelHD.length > 0" class="pyramid-level level-4">
      <div class="level-label">
        <span class="badge bg-warning text-dark px-3 py-2">
          <i class="bi bi-headset me-1"></i> Help Desk (HD)
        </span>
      </div>
      <div class="level-cards">
        <div *ngFor="let emp of nivelHD" 
             class="pyramid-card card-hd"
             (click)="seleccionarEmpleado(emp)">
          <div class="card-inner">
            <img [src]="getFoto(emp)" 
                 class="emp-img"
                 (error)="onImageError($event)"
                 alt="{{ emp.nombre }}">
            <div class="emp-info">
              <h6 class="emp-name">{{ emp.nombre }}</h6>
              <small class="emp-cargo">{{ getNivelDisplay(emp) }}</small>
              <!-- SIN BADGE DE ROL -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 5Ô∏è‚É£ NIVEL: NOC - SIN ROL -->
    <div *ngIf="nivelNOC.length > 0" class="pyramid-level level-5">
      <div class="level-label">
        <span class="badge bg-dark px-3 py-2">
          <i class="bi bi-hdd-network me-1"></i> Network Operations Center (NOC)
        </span>
      </div>
      <div class="level-cards">
        <div *ngFor="let emp of nivelNOC" 
             class="pyramid-card card-noc"
             (click)="seleccionarEmpleado(emp)">
          <div class="card-inner">
            <img [src]="getFoto(emp)" 
                 class="emp-img"
                 (error)="onImageError($event)"
                 alt="{{ emp.nombre }}">
            <div class="emp-info">
              <h6 class="emp-name">{{ emp.nombre }}</h6>
              <small class="emp-cargo">{{ getNivelDisplay(emp) }}</small>
              <!-- SIN BADGE DE ROL -->
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- üì± RESPONSIVE INFO -->
  <div class="text-center mt-4 text-muted">
    <small>
      <i class="bi bi-info-circle me-1"></i>
      Haz clic en cualquier colaborador para ver informaci√≥n general
    </small>
  </div>

</div>

<!-- üë§ MODAL DETALLE EMPLEADO (SIN INFORMACI√ìN SENSIBLE Y SIN ROL) -->
<div *ngIf="mostrarDetalle" class="modal-backdrop fade show"></div>
<div *ngIf="mostrarDetalle" 
     class="modal fade show d-block" 
     tabindex="-1"
     (click)="cerrarDetalle()">
  <div class="modal-dialog modal-lg modal-dialog-centered" (click)="$event.stopPropagation()">
    <div class="modal-content border-0 shadow-lg">
      
      <!-- HEADER -->
      <div class="modal-header border-0 bg-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-person-badge me-2"></i>
          Informaci√≥n del Colaborador
        </h5>
        <button type="button" 
                class="btn-close btn-close-white" 
                (click)="cerrarDetalle()"
                aria-label="Close"></button>
      </div>
      
      <!-- BODY -->
      <div class="modal-body p-4">
        
        <!-- LOADING -->
        <div *ngIf="isLoadingDetalle" class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p class="text-muted mt-2">Cargando informaci√≥n del colaborador...</p>
        </div>
        
        <!-- CONTENIDO -->
        <div *ngIf="!isLoadingDetalle && empleadoSeleccionado" class="row">
          <!-- Columna izquierda: Solo foto y nombre -->
          <div class="col-md-4 text-center">
            <img [src]="getFoto(empleadoSeleccionado)" 
                 class="rounded-circle border border-4 border-primary shadow mb-3"
                 width="150" 
                 height="150"
                 style="object-fit: cover;"
                 (error)="onImageError($event)"
                 alt="{{ empleadoSeleccionado.nombre }}">
            
            <h4 class="fw-bold mb-1">{{ empleadoSeleccionado.nombre }}</h4>
            <p class="text-muted mb-3">{{ empleadoSeleccionado.cargo || getNivelDisplay(empleadoSeleccionado) }}</p>
            
            <!-- SIN BADGE DE ROL EN MODAL -->
            
            <!-- Cumplea√±os -->
            <div *ngIf="empleadoSeleccionado.cumpleanos" 
                 class="alert alert-success py-2 mb-3">
              <div class="d-flex align-items-center">
                <i class="bi bi-balloon-heart-fill fs-5 me-2"></i>
                <div>
                  <strong class="d-block">üéÇ Cumplea√±os</strong>
                  {{ getFormatoFecha(empleadoSeleccionado.cumpleanos) }}
                  <span *ngIf="calcularEdad(empleadoSeleccionado.cumpleanos)" 
                        class="text-muted">
                    ‚Ä¢ {{ calcularEdad(empleadoSeleccionado.cumpleanos) }} a√±os
                  </span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Columna derecha: Informaci√≥n personal -->
          <div class="col-md-8">
            <!-- Hobby y Descripci√≥n -->
            <div class="card mb-3 border-0 shadow-sm">
              <div class="card-body">
                <h6 class="card-title text-primary fw-bold mb-3">
                  <i class="bi bi-info-circle me-2"></i>Informaci√≥n Personal
                </h6>
                
                <div class="row">
                  <!-- Hobby -->
                  <div *ngIf="empleadoSeleccionado.hobby" class="col-12 mb-3">
                    <label class="text-muted small">Hobby / Inter√©s</label>
                    <p class="mb-0">
                      <i class="bi bi-joystick text-primary me-2"></i>
                      {{ empleadoSeleccionado.hobby }}
                    </p>
                  </div>
                  
                  <!-- Descripci√≥n -->
                  <div *ngIf="empleadoSeleccionado.descripcion" class="col-12 mb-3">
                    <label class="text-muted small">Descripci√≥n Personal</label>
                    <p class="mb-0" style="text-align: justify;">
                      {{ empleadoSeleccionado.descripcion }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Informaci√≥n laboral -->
            <div class="card border-0 shadow-sm">
              <div class="card-body">
                <h6 class="card-title text-primary fw-bold mb-3">
                  <i class="bi bi-briefcase me-2"></i>Informaci√≥n Laboral
                </h6>
                
                <div class="row">
                  <!-- Fecha de ingreso -->
                  <div *ngIf="empleadoSeleccionado.ingreso" class="col-12 col-md-6 mb-3">
                    <label class="text-muted small">Fecha de Ingreso</label>
                    <p class="mb-0">
                      <i class="bi bi-calendar-check text-primary me-2"></i>
                      {{ getFormatoFecha(empleadoSeleccionado.ingreso) }}
                    </p>
                  </div>
                  
                  <!-- Tiempo en la empresa -->
                  <div *ngIf="empleadoSeleccionado.ingreso" class="col-12 col-md-6 mb-3">
                    <label class="text-muted small">Tiempo en la Empresa</label>
                    <p class="mb-0 fw-bold text-success">
                      <i class="bi bi-clock-history text-success me-2"></i>
                      {{ calcularTiempoEnEmpresa(empleadoSeleccionado.ingreso) }}
                    </p>
                  </div>
                  
                  <!-- Estado -->
                  <div class="col-12 col-md-6 mb-3">
                    <label class="text-muted small">Estado</label>
                    <p class="mb-0">
                      <i class="bi bi-circle-fill me-2" 
                         [ngClass]="{
                           'text-success': empleadoSeleccionado.activo,
                           'text-danger': !empleadoSeleccionado.activo
                         }"></i>
                      <span *ngIf="empleadoSeleccionado.activo">
                        Activo en la empresa
                      </span>
                      <span *ngIf="!empleadoSeleccionado.activo">
                        No activo
                      </span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- FOOTER -->
      <div class="modal-footer border-0 bg-light">
        <button type="button" 
                class="btn btn-outline-primary"
                (click)="cerrarDetalle()">
          <i class="bi bi-x-circle me-1"></i> Cerrar
        </button>
        <small class="text-muted ms-auto">
          <i class="bi bi-info-circle me-1"></i>
          Zona horaria: Per√∫ (UTC-5)
        </small>
      </div>
    </div>
  </div>
</div>